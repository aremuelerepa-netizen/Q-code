<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<title>Q-CODE | Live Status</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; margin: 0; overflow-x: hidden; }
    .glass { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.08); border-radius: 2rem; }
    .btn-cyan { background: linear-gradient(135deg, #22d3ee 0%, #0ea5e9 100%); transition: all 0.2s; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
    .status-ring { width: 220px; height: 220px; border-radius: 50%; border: 8px solid rgba(34, 211, 238, 0.15); border-top-color: #22d3ee; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto; animation: spin 2s linear infinite; }
    .ring-inner { animation: counter-spin 2s linear infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes counter-spin { 100% { transform: rotate(-360deg); } }
    .page { display: none; animation: fadeIn 0.4s ease-out; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .logout-btn { font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
</style>
</head>
<body>

<div class="max-w-[450px] mx-auto min-h-screen flex flex-col relative">

    <!-- Header -->
    <header class="p-5 flex justify-between items-center glass sticky top-0 z-50 shadow-lg shadow-cyan-500/20">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 btn-cyan rounded-xl flex items-center justify-center shadow-xl shadow-cyan-500/30">
                <i data-lucide="zap" class="w-6 h-6 text-slate-900"></i>
            </div>
            <div>
                <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest block">Q-CODE</span>
                <span id="user-display-name" class="text-lg md:text-xl font-extrabold text-white uppercase">User</span>
            </div>
        </div>
        <button onclick="handleLogout()" class="w-12 h-12 rounded-xl bg-rose-500/20 border border-white/10 flex items-center justify-center logout-btn hover:bg-rose-500/40 transition">
            <i data-lucide="log-out" class="w-6 h-6 text-white"></i>
        </button>
    </header>

    <!-- Main -->
    <main class="flex-1 p-6 pb-32">
        <section id="page-home" class="page active">
            
            <!-- Quick Join -->
            <div class="mb-12">
                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4 block">New Check-in</label>
                <div class="glass p-3 rounded-3xl flex gap-3">
                    <input type="text" id="joinInput" placeholder="SERVICE CODE" class="flex-1 bg-transparent px-4 py-3 font-extrabold text-white text-center outline-none uppercase tracking-wide text-sm md:text-base rounded-xl">
                    <button onclick="handleJoin()" class="btn-cyan px-6 py-3 rounded-2xl text-slate-900 text-[12px] md:text-sm uppercase shadow-lg shadow-cyan-500/30">
                        Join
                    </button>
                </div>
            </div>

            <!-- Active Queues -->
            <div id="queue-container" class="space-y-16"></div>
        </section>
    </main>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[calc(100%-48px)] max-w-[400px] h-20 glass rounded-[2.5rem] flex justify-around items-center z-40 border-white/10 shadow-2xl">
        <button onclick="nav('home')" class="text-cyan-400"><i data-lucide="home" class="w-6 h-6"></i></button>
        <button onclick="location.reload()" class="text-slate-500"><i data-lucide="refresh-cw" class="w-6 h-6"></i></button>
    </nav>

</div>

<script>
    lucide.createIcons();

    // Load user info & active tickets
    window.onload = () => {
        const savedName = localStorage.getItem('visitor_name') || 'Guest User';
        document.getElementById('user-display-name').innerText = savedName;
        renderActiveQueues();
    };

    function nav(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
    }

    function handleLogout() {
        if(confirm("Are you sure you want to logout?")) {
            localStorage.clear();
            window.location.href = "/login";
        }
    }

    function renderActiveQueues() {
        const container = document.getElementById('queue-container');
        const tickets = JSON.parse(localStorage.getItem('active_tickets') || "[]");

        if(tickets.length === 0) {
            container.innerHTML = `
                <div class="text-center py-20 opacity-50">
                    <i data-lucide="ghost" class="w-14 h-14 mx-auto mb-4"></i>
                    <p class="font-black text-[12px] uppercase tracking-widest">No active lines</p>
                </div>`;
            lucide.createIcons();
            return;
        }

        container.innerHTML = tickets.map(t => `
            <div class="text-center">
                <div class="status-ring mb-6">
                    <div class="ring-inner">
                        <span class="text-[10px] font-black text-slate-400 uppercase block">Position</span>
                        <span class="text-6xl font-black italic text-white tracking-tighter">#${t.position}</span>
                    </div>
                </div>
                <h2 class="text-2xl md:text-3xl font-black uppercase italic tracking-tight">${t.service_name}</h2>
                <p class="text-[10px] md:text-sm text-cyan-400 font-bold uppercase tracking-[0.3em] mt-2 animate-pulse">Live Updates Active</p>
                
                <button onclick="leaveQueue('${t.ticket_id}')" class="mt-6 text-rose-500 text-[12px] font-black uppercase tracking-widest opacity-60 hover:opacity-100 transition">
                    Cancel Spot
                </button>
            </div>
        `).join('<hr class="border-white/10 my-12">');

        lucide.createIcons();
    }

    function handleJoin() {
        const code = document.getElementById('joinInput').value.trim().toUpperCase();
        if(!code) return;

        // Mock API response
        const mockResponse = {
            status: 'success',
            ticket_id: 'TK-' + Math.random().toString(36).substr(2, 5),
            service_name: 'Tech Support',
            position: 5
        };

        let tickets = JSON.parse(localStorage.getItem('active_tickets') || "[]");
        tickets.push(mockResponse);
        localStorage.setItem('active_tickets', JSON.stringify(tickets));

        document.getElementById('joinInput').value = '';
        renderActiveQueues();
    }

    function leaveQueue(ticketId) {
        let tickets = JSON.parse(localStorage.getItem('active_tickets') || "[]");
        tickets = tickets.filter(t => t.ticket_id !== ticketId);
        localStorage.setItem('active_tickets', JSON.stringify(tickets));
        renderActiveQueues();
    }
</script>

</body>
</html>
